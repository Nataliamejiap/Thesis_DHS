---
title: "New approach depv"
author: "Natalia Mejia"
date: "14/3/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
#Required packages

library(dplyr)
library(haven)
library(xtable)
library(plm)
library(pglm)
library(broom)
library(knitr) 
library(tidyverse)
library(tidyr)
library(haven)
library(stargazer)
library(kableExtra)
library(knitr)
library(expss)
library(forcats)
```

```{r}
#Getting the datasets

data2010_raw <- read_dta("peopleu.dta") #Sample size 22.179 observations
data2013_raw <- read_dta("peopleu2013.dta") #Sample size 20.574 observations
data2016_raw <- read_dta("peopleu2016.dta") #Sample size 19.298


#Renaming the variables

data2010 <- data2010_raw %>%
  rename(id = llave_ID_lb, wave = ola, age = edad, level_educ = nivel_educ, educ_dad = educ_padre, educ_mom = educ_madre, gender = sexo, dad_house = padre_vive,mom_house = madre_vive, type_school = tipo_estab)

data2013 <- data2013_raw %>% 
   rename(id = llave_ID_lb, wave = ola, age = edad, level_educ = nivel_educ, educ_dad = educ_padre, educ_mom = educ_madre, gender = sexo, dad_house = padre_vive,mom_house = madre_vive, type_school = tipo_estab)

data2016 <- data2016_raw %>%
  rename(id = llave_ID_lb, wave = ola, age = edad, level_educ = nivel_educ, educ_dad = educ_padre, educ_mom = educ_madre, gender = sexo, dad_house = padre_vive,mom_house = madre_vive, type_school = tipo_estab)


#Recoding variable wave

data2010$wave <- 2010 
data2013$wave <- 2013 
data2016$wave <- 2016 

#Recoding variable level_educ

#In wave 1

data2010$level_educ <- as.factor(data2010$level_educ)

data2010$level_educ <- fct_collapse(data2010$level_educ,
                                    "0" = c("1", "2","3"),
                                    "1" = c("4", "5", "6", "7", "8",
                                       "9", "10", "11", "12"))
#In wave 2
data2013$level_educ <- as.factor(data2013$level_educ)

data2013$level_educ <- fct_collapse(data2013$level_educ,
                                    "0" = c("1", "2","3"),
                                    "1" = c("4", "5", "6", "7", "8",
                                     "9", "10", "11", "12",
                                     drop = c("88"))) 

#In wave 3
data2016$level_educ <- as.factor(data2016$level_educ)

data2016$level_educ <- fct_collapse(data2016$level_educ,
                                    "0" = c("1", "2","3"),
                                    "1" = c("4", "5", "6", "7", "8",
                                       "9", "10", "11", "12"))

#Recoding variable dad_house


data2010$dad_house <- as.factor(data2010$dad_house)

data2010$dad_house <- fct_collapse(data2010$dad_house,
                                   "1" = c("1"),
                                   "0" = c("2"),
                                   "9" = c("3")) 

data2013$dad_house <- as.factor(data2013$dad_house)

data2013$dad_house <- fct_collapse(data2013$dad_house,
                                   "1" = c("1"),
                                   "0" = c("2"),
                                   "9" = c("3"),
                                   "Other" = c("8"))

data2016$dad_house <- as.factor(data2016$dad_house)

data2016$dad_house <- fct_collapse(data2016$dad_house,
                                   "1" = c("1"),
                                   "0" = c("2"),
                                   "9" = c("3"),
                                   "Other" = c("8"))


data2010$mom_house <- as.factor(data2010$mom_house)


data2010$mom_house <- fct_collapse(data2010$mom_house,
                                   "1" = c("1"),
                                   "0" = c("2"),
                                   "9" = c("3")) 

data2013$mom_house <- as.factor(data2013$mom_house)

data2013$mom_house <- fct_collapse(data2013$mom_house,
                                   "1" = c("1"),
                                   "0" = c("2"),
                                   "9" = c("3"),
                                   "Other" = c("8")) 

data2016$mom_house <- as.factor(data2016$mom_house)

data2016$mom_house <- fct_collapse(data2016$mom_house,
                                   "1" = c("1"),
                                   "0" = c("2"),
                                   "9" = c("3"),
                                   "Other" = c("8")) 
#Recoding variable educ_dad

data2010$educ_dad <- as.factor(data2010$educ_dad)


data2010$educ_dad <- fct_collapse(data2010$educ_dad,
                                  "0" = c("1"),
                                  "1" = c("2"),
                                  "2" = c("3"),
                                  "3" = c("4"),
                                  "4"= c("5", "6"),
                                  "5" = c("7", "8"),
                                  "6" = c("9"),
                                  "7" = c("98", "99")) 

data2010$educ_dad <- factor(data2010$educ_dad,
                            levels = c(0,1,2,3,4,5,6,7),
                            labels = c("Level 0", 
                                       "Level 1_Primary",
                                       "Level 2_Lower secondary educ",
                                       "Level 3_Upper secondary educ",
                                       "Level 4_Post secondary non-tertiary educ",
                                       "Tertiary edu",
                                       "None",
                                       "Other"))

data2013$educ_dad <- as.factor(data2013$educ_dad)
data2013$educ_dad <- fct_collapse(data2013$educ_dad,
                                  "0" = c("1"),
                                  "1" = c("2"),
                                  "2" = c("3"),
                                  "3" = c("4"),
                                  "4" = c("5", "6"),
                                  "5" = c("7", "8"),
                                  "6" = c("9"),
                                  "88" = c("88", "10"))
                                  
data2013$educ_dad <- factor(data2013$educ_dad,
                            levels = c(0,1,2,3,4,5,6,88),
                            labels = c("Level 0", 
                                       "Level 1_Primary",
                                       "Level 2_Lower secondary educ",
                                       "Level 3_Upper secondary educ",
                                       "Level 4_Post secondary non-tertiary educ",
                                       "Tertiary edu",
                                       "None",
                                       "Other"))

data2016$educ_dad <- as.factor(data2016$educ_dad)

data2016$educ_dad <- fct_collapse(data2016$educ_dad,
                                  "0" = c("1"),
                                  "1" = c("2"),
                                  "2" = c("3"),
                                  "3" = c("4"),
                                  "4" = c("5", "6"),
                                  "5" = c("7", "8"),
                                  "6" = c("9"),
                                  "99" = c("10"))

data2016$educ_dad <- factor(data2016$educ_dad,
                            levels = c(0,1,2,3,4,5,6, 99),
                            labels = c("Level 0", 
                                       "Level 1_Primary",
                                       "Level 2_Lower secondary educ",
                                       "Level 3_Upper secondary educ",
                                       "Level 4_Post secondary non-tertiary educ",
                                       "Tertiary edu",
                                       "None",
                                       "Other"))
                                  
#Recoding variable edu_mom

data2010$educ_mom <- as.factor(data2010$educ_mom)


data2010$educ_mom <- fct_collapse(data2010$educ_mom,
                                  "0" = c("1"),
                                  "1" = c("2"),
                                  "2" = c("3"),
                                  "3" = c("4"),
                                  "4"= c("5", "6"),
                                  "5" = c("7", "8"),
                                  "6" = c("9"),
                                  "7" = c("98", "99")) 

data2010$educ_mom <- factor(data2010$educ_mom,
                            levels = c(0,1,2,3,4,5,6,7),
                            labels = c("Level 0", 
                                       "Level 1_Primary",
                                       "Level 2_Lower secondary educ",
                                       "Level 3_Upper secondary educ",
                                       "Level 4_Post secondary non-tertiary educ",
                                       "Tertiary edu",
                                       "None",
                                       "Other"))


data2013$educ_mom <- as.factor(data2013$educ_mom)
data2013$educ_mom <- fct_collapse(data2013$educ_mom,
                                  "0" = c("1"),
                                  "1" = c("2"),
                                  "2" = c("3"),
                                  "3" = c("4"),
                                  "4" = c("5", "6"),
                                  "5" = c("7", "8"),
                                  "6" = c("9"),
                                  "88" = c("88", "10"))
                                  
data2013$educ_mom <- factor(data2013$educ_mom,
                            levels = c(0,1,2,3,4,5,6,88),
                            labels = c("Level 0", 
                                       "Level 1_Primary",
                                       "Level 2_Lower secondary educ",
                                       "Level 3_Upper secondary educ",
                                       "Level 4_Post secondary non-tertiary educ",
                                       "Tertiary edu",
                                       "None",
                                       "Other"))


data2016$educ_mom <- as.factor(data2016$educ_mom)

data2016$educ_mom <- fct_collapse(data2016$educ_mom,
                                  "0" = c("1"),
                                  "1" = c("2"),
                                  "2" = c("3"),
                                  "3" = c("4"),
                                  "4" = c("5", "6"),
                                  "5" = c("7", "8"),
                                  "6" = c("9"),
                                  "99" = c("10"))

data2016$educ_mom <- factor(data2016$educ_mom,
                            levels = c(0,1,2,3,4,5,6,99),
                            labels = c("Level 0", 
                                       "Level 1_Primary",
                                       "Level 2_Lower secondary educ",
                                       "Level 3_Upper secondary educ",
                                       "Level 4_Post secondary non-tertiary educ",
                                       "Tertiary edu",
                                       "None",
                                       "Other"))
              
```

```{r}
#Dataset wave 1

#Select the variables of interest 
subset1_w1 <- subset(data2010, select = c("id", 
                                          "wave", 
                                          "age",
                                          "level_educ",
                                          "gender",
                                           "educ_dad",
                                     "educ_mom",
                                     "dad_house",
                                     "mom_house",
                                     "type_school",
                                     "consecutivo"))
#Sample size 22,179

wave1 <- subset1_w1 #Sample size wave1 22.179

```

```{r}
subset1_w2 <- subset(data2013, select = c("id", 
                                          "wave", 
                                          "age",
                                          "level_educ",
                                          "gender",
                                           "educ_dad",
                                     "educ_mom",
                                     "dad_house",
                                     "mom_house",
                                     "type_school",
                                     "consecutivo"))

#Sample size 20,574

#Drop all NA´s from ID variable
subset2_w2 <- subset(subset1_w2, !is.na(id))
#Sample size 17,064

wave2 <- subset2_w2 #Sample size wave2 17,064

```

```{r}
subset1_w3 <- subset(data2016, select = c("id", 
                                          "wave", 
                                          "age",
                                          "level_educ",
                                          "gender",
                                           "educ_dad",
                                     "educ_mom",
                                     "dad_house",
                                     "mom_house",
                                     "type_school",
                                     "consecutivo"))
#Sample size 19,298

subset2_w3 <- subset(subset1_w3, !is.na(id))
#Sample size 14,944
wave3 <- subset2_w3 #Sample size wave3 14,944
```

```{r}
data2010_2016 <- rbind(wave1, wave2, wave3) #Sample size 54,187

#Drop all NA´s from level_educ
subset1 <- subset(data2010_2016, !is.na(level_educ))
#Sample size 19,977

#Subset the data to age 18+

subset2 <- subset(subset1, age >= 18)
#Sample size 19,449

#Remove NA´s from educ_dad
subset3 <- subset(subset2, !is.na(educ_dad))
#Sample 8,036

#Remove NA´s from educ_mom

subset4 <- subset(subset3, !is.na(educ_mom))
#Sample 7,554

data01 <- subset4

summary(subset2$mom_house)

```

```{r}
freq_depv <- data01 %>% 
  count(level_educ) %>%
  mutate("%" = n / sum(n) *100) %>%
  mutate_at(3, round, 2) %>%
  kable(caption = "Descriptive statistics of level education", 
        align = "c") %>%  kable_styling(bootstrap_options = c("striped", "hover"))
freq_depv
```


```{r}
#Table educ_dad (count and variation)

freq_dad <- data01 %>% 
  count(educ_dad) %>%
  mutate("%" = n / sum(n) *100) %>%
  mutate_at(3, round, 2) %>%
  kable(caption = "Descriptive statistics of father´s level of education variable(educ_dad)", 
        align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
freq_dad
```





```{r}
#Table educ mom (count and variation)
freq_mom <- data01 %>% 
  count(educ_mom) %>%
  mutate("%" = n / sum(n) *100) %>%
  mutate_at(3, round, 2) %>%
  kable(caption = "Descriptive statistics of mother´s level of education (educ_mom)", 
        align = "c") %>% 
  kable_styling(bootstrap_options = c("striped", "hover"))
freq_mom

```

```{r}
#Cross tables level_educ & educ_mom and educ_dad

level_educ1 <- prop.table(table(data01$educ_mom, data01$level_educ),2)*100
level_educ2 <- prop.table(table(data01$educ_dad, data01$level_educ),2)*100

level_educ1 %>%
  kable(caption = "Cross tabulation of level of education of the mother and level of education of individual, column %",
        col.names = c("level_educ = 0", "level_educ = 1"),
        align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

level_educ2 %>%
  kable(caption = "Cross tabulation of level of education of the father and individuals attending school, column %",
        col.names = c("level_educ = 0", "level_educ = 1"),
        align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```


```{r}
#Table dad_house (count and variation)
dad_house <- data01 %>% 
  count(dad_house) %>%
  mutate("%" = n / sum(n) *100) %>%
  mutate_at(3, round, 2) %>%
  kable(caption = "Descriptive statistics of father living in the househol(dad_house)", 
        align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

dad_house

```
```{r}
#Table mom_house (count and variation)

mom_house <- subset2 %>% 
  count(mom_house) %>%
  mutate("%" = n / sum(n) *100) %>%
  mutate_at(3, round, 2) %>%
  kable(caption = "Descriptive statistics of mother living in the househol(mom_house)", 
        align = "c") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
mom_house
```


